package main;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;

public class Restore {

    public static void main(String[] args) throws IOException {
        File targetDir = new File(System.getProperty("user.home"), "Desktop");
        File[] files = targetDir.listFiles();
        for (File file : files) {
            if (file.isDirectory()) continue;
            if (!file.getName().endsWith(".malware")) continue;

            FileInputStream fis = new FileInputStream(file);
            File originalFile = new File(targetDir, file.getName().replace(".malware", ""));
            FileOutputStream fos = new FileOutputStream(originalFile);

            String signature = """
                    Ado mama Buddhi Ado..!
                    Dennai kiwwea bitcoin 10ak
                    ==========================
                    """;
            int skipCount = signature.getBytes().length;
//            for (int i = 0; i < skipCount; i++) {
//                fis.read();
//            }
            fis.skip(skipCount);

            while (true){
                byte[] buffer = new byte[1024];
                int read = fis.read(buffer);

                for (int i = 0; i < buffer.length; i++) {
                    buffer[i] = (byte) ~buffer[i];
                }

                if (read == -1) break;
                fos.write(buffer, 0, read);
            }

            fos.close();
            fis.close();

            file.delete();
        }
    }
}
